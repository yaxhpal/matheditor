function editMath() {
    if (isSave === true) {
        $("#display").attr("contenteditable", "true");
        $("#display").html(global);
        isSave = false;
        $("#render").css("display", "");
        $("#rerender").css("display", "none")
    }
}

function saveMath() {
    if (isSave === false) {
        var e = document.getElementById("display");
        global = $("#display").html();
        if (global !== "") {
            MathJax.Hub.Queue(["Typeset", MathJax.Hub, e]);
            $("#display").removeAttr("contenteditable");
            isSave = true;
            $("#render").css("display", "none");
            $("#rerender").css("display", "")
        } else {
            $("#dialog").dialog("open")
        }
    }
}

function handleLatex(e, t) {
    e = e.replace(new RegExp("\\\\hept{", "g"), "").replace(new RegExp("cases}}", "g"), "cases}");
    e = "$" + e + "$";
    pasteHtmlAtCaret(e, t)
}

function passValue() {
    var e = $("#latex-source").val();
    var t = document.getElementById("display");
    if (e !== "" && isSave === false) {
        if (e !== "") {
            handleLatex(e, t);
            isSave = false;
            saveMath()
        } else {
            $("#dialog2").dialog("open")
        }
    } else {
        if (e !== "") {
            isSave = true;
            editMath();
            handleLatex(e, t);
            isSave = false;
            saveMath()
        } else {
            $("#dialog2").dialog("open")
        }
    }
    clearValue()
}

function clearInsert() {
    isSave = false;
    $("#display").attr("contenteditable", "true");
    $("#display").text("");
    $("#render").css("display", "");
    $("#rerender").css("display", "none")
}

function clearValue() {
    $("#latex-source").val("");
    $("#editable-math").mathquill("latex", "")
}

function getLatex(e) {
    if (e === 1) {
        var t = $("#latex-source").val();
        if (t !== "") {
            var n = window.open("", "MsgWindow", "toolbar=yes,   top=400, left=200, width=500, height=400");
            t = t.replace(new RegExp("\\\\hept{", "g"), "");
            t = t.replace(new RegExp("cases}}", "g"), "cases}");
            n.document.write("<p>" + t + "</p>")
        } else {
            alert("Empty value")
        }
    } else {
        var t = $("#display script").text();
        if (t !== "") {
            var n = window.open("", "MsgWindow", "toolbar=yes,   top=400, left=200, width=500, height=400");
            n.document.write("<p>" + t + "</p>")
        } else {
            $("#dialog").dialog("open")
        }
    }
}

function getImage(e) {
    if (e === 1) {
        var t = $("#latex-source").val();
        if (t !== "") {
            t = t.replace(new RegExp("\\\\hept{", "g"), "");
            t = t.replace(new RegExp("cases}}", "g"), "cases}");
            var n = window.open("http://latex.codecogs.com/png.download?" + t, "_0", "toolbar=yes,   top=400, left=200, width=500, height=400");
            smyWindow.open()
        } else {
            alert("Empty value")
        }
    } else {
        var t = $("#display script").text();
        if (t !== "") {
            var n = window.open("http://latex.codecogs.com/png.download?" + t, "_0", "toolbar=yes,   top=400, left=200, width=500, height=400");
            n.open()
        } else {
            $("#dialog").dialog("open")
        }
    }
}

function getMathML() {
    MathJax.Hub.Queue(function() {
        var e = MathJax.Hub.getAllJax("display");
        var t = "";
        if (e.length !== 0) {
            for (var n = 0; n < e.length; n++) {
                toMathML(e[n], function(e) {
                    t += e
                })
            }
            var r = window.open("", "MsgWindow", "toolbar=yes,   top=400, left=200, width=500, height=400");
            t = t.replace(/^\s*/, "").replace(/\s*$/, "").replace(/<math xmlns=\"http:\/\/www.w3.org\/1998\/Math\/MathML\">/g, "").replace(/<\/math>\n/g, "");
            t = '<math xmlns="http://www.w3.org/1998/Math/MathML">' + t + "</math>";
            t = t.replace(/&/g, "&").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            r.document.write("<html><head><title>" + "MatML Source" + "</title></head><body style='font-size:85%'>");
            r.document.write("<table><tr><td><pre>" + t + "</pre></td></tr></table>");
            r.document.write("</body></html>");
            r.document.close()
        } else {
            $("#dialog").dialog("open")
        }
    })
}
var checkmatrix;
var global;
var isSave = false;
$("#display").delegate("span.MathJax", "click", function() {
    var e = $(this).next();
    var t = e.html();
    t = t.replace(new RegExp("\\\\limits", "g"), "limits").replace(new RegExp("begin{cases}", "g"), "hept{\\begin{cases}").replace(new RegExp("end{cases}", "g"), "end{cases}}");
    $("#editable-math").mathquill("write", t);
    t = t.replace(new RegExp("limits", "g"), "\\limits");
    $("#latex-source").val($("#latex-source").val() + t)
})